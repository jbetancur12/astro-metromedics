---
const pathname = Astro.url.pathname;

---

<nav
  id="header"
  class="fixed w-full z-50 top-0 text-black border-y-green-500 border-t-6 bg-white"
>
  <div
    class="w-full container mx-auto flex items-center justify-between mt-0 py-2"
  >
    <div class="pl-4 flex items-center">
      <a
        class="toggleColour text-black no-underline hover:no-underline font-bold text-2xl lg:text-4xl"
        href="/"
      >
        <img
          class="max-w-[200px] md:max-w-[240px] lg:max-w-[280px] xl:max-w-[320px] mx-auto h-auto"
          src="/images/Logo-pagina-web.png"
          alt="MetroMedics - Servicios de Calibración y Mantenimiento"
          loading="eager"
          width="280"
          height="auto"
        />
      </a>
    </div>
    <div class="block nav:hidden pr-4">
      <button
        id="nav-toggle"
        class="flex items-center p-2 text-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transform transition hover:scale-105 duration-300 ease-in-out rounded-md min-h-[44px] min-w-[44px] justify-center"
        aria-label="Abrir menú de navegación"
        aria-expanded="false"
        aria-controls="nav-content"
        aria-haspopup="true"
      >
        <svg
          class="fill-current h-6 w-6"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <title>Menu</title>
          <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path>
        </svg>
      </button>
    </div>

    <div
      class="w-full flex-grow nav:flex nav:items-center nav:w-auto hidden mt-2 nav:mt-0 bg-white nav:bg-transparent text-black p-4 nav:p-0 z-20"
      id="nav-content"
    >
      <ul class="list-reset nav:flex justify-end flex-1 items-center text-sm nav:text-base">
        <li class="mr-3">
          <a
            class="inline-block py-2 px-4 text-black no-underline hover:text-green-300 hover:underline focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            class:list={[pathname == "/" && "text-green-400 font-bold"]}
            href="/">Inicio</a
          >
        </li>
        <li class="mr-3">
          <a
            class="inline-block text-black no-underline hover:text-green-300 hover:underline py-2 px-4 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            class:list={[
              pathname == "/servicios" && "text-green-400 font-bold",
            ]}
            href="/servicios">Servicios</a
          >
        </li>
        <li class="mr-3">
          <a
            id="laboratoriosLink"
            class="text-black no-underline py-2 px-4 flex items-center group hover:text-green-300 hover:underline focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            href="#"
            aria-expanded="false"
            aria-haspopup="true"
            aria-controls="laboratorios"
          >
            Laboratorios
            <span class="ml-2">
              <svg
                id="angle-up"
                class="hidden w-6 h-6 text-black dark:text-black group-hover:text-green-300"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 14 8"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7 7.674 1.3a.91.91 0 0 0-1.348 0L1 7"></path>
              </svg>
              <svg
                id="angle-down"
                class="w-6 h-6 text-black dark:text-black group-hover:text-green-300"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 14 8"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m1 1 5.326 5.7a.909.909 0 0 0 1.348 0L13 1"></path>
              </svg>
            </span>
          </a>

          <div
            id="laboratorios"
            class="absolute rounded-lg bg-white py-2 hidden shadow-lg border border-gray-200 mt-1 z-10"
            role="menu"
            aria-labelledby="laboratoriosLink"
          >
            <a
              href="/laboratorios/laboratorio-acreditado"
              class="block px-4 py-2 text-black hover:bg-green-300 hover:text-black focus:outline-none focus:bg-green-300 focus:text-black transition-colors duration-200"
              role="menuitem"
              >Laboratorio Acreditado</a
            >
            <a
              href="/laboratorios/laboratorio-con-trazabilidad-sector-biomedico-e-industrial"
              class="block px-4 py-2 text-black hover:bg-green-300 hover:text-black focus:outline-none focus:bg-green-300 focus:text-black transition-colors duration-200"
              role="menuitem"
              >Laboratorio con Trazabilidad sector Biomédico e Industrial</a
            >
          </div>
        </li>
        <li class="mr-3">
          <a
            class="inline-block text-black no-underline hover:text-green-300 hover:underline py-2 px-4 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            class:list={[pathname == "/nosotros" && "text-green-400 font-bold"]}
            href="/nosotros">Nosotros</a
          >
        </li>
        <li class="mr-3">
          <a
            class="inline-block text-black no-underline hover:text-green-300 hover:underline py-2 px-4 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            class:list={[
              pathname == "/evaluacion-del-servicio" &&
                "text-green-400 font-bold",
            ]}
            href="/evaluacion-del-servicio">Evaluar servicio</a
          >
        </li>
        <li class="mr-3">
          <a
            class="inline-block text-black no-underline hover:text-green-300 hover:underline py-2 px-4 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            class:list={[pathname == "/pqr" && "text-green-400 font-bold"]}
            href="/pqr">PQR</a
          >
        </li>
        <li class="mr-3">
          <a
            class="inline-block text-black no-underline hover:text-green-300 hover:underline py-2 px-4 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            class:list={[pathname == "/contact" && "text-green-400 font-bold"]}
            href="/contacto">Contacto</a
          >
        </li>

        <li class="mr-3">
          <a
            id="clientesLink"
            class="text-black no-underline py-2 px-4 flex items-center group hover:text-green-300 hover:underline focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 rounded-md transition-colors duration-200"
            href="#"
            aria-expanded="false"
            aria-haspopup="true"
            aria-controls="clientes"
          >
            Clientes
            <span class="ml-2">
              <svg
                id="angle-up-clientes"
                class="hidden w-6 h-6 text-black dark:text-black group-hover:text-green-300"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 14 8"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7 7.674 1.3a.91.91 0 0 0-1.348 0L1 7"></path>
              </svg>
              <svg
                id="angle-down-clientes"
                class="w-6 h-6 text-black dark:text-black group-hover:text-green-300"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 14 8"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="m1 1 5.326 5.7a.909.909 0 0 0 1.348 0L13 1"></path>
              </svg>
            </span>
          </a>
          <div
            id="clientes"
            class="absolute rounded-lg bg-white py-2 hidden shadow-lg border border-gray-200 mt-1 z-10"
            role="menu"
            aria-labelledby="clientesLink"
          >
            <a
              href="https://app.metromedics.co/login"
              class="block px-4 py-2 text-black hover:bg-green-300 hover:text-black focus:outline-none focus:bg-green-300 focus:text-black transition-colors duration-200"
              role="menuitem"
              >Calibraciones</a
            >
            <a
              href="/mantenimiento"
              class="block px-4 py-2 text-black hover:bg-green-300 hover:text-black focus:outline-none focus:bg-green-300 focus:text-black transition-colors duration-200"
              role="menuitem"
              >Tickets</a
            >
            <a
              href="https://fm34.easytechpro.com/fmi/webd"
              class="block px-4 py-2 text-black hover:bg-green-300 hover:text-black focus:outline-none focus:bg-green-300 focus:text-black transition-colors duration-200"
              role="menuitem"
              >Mantenimiento</a
            >
          </div>
        </li>
      </ul>
    </div>
  </div>

  <div
    id="burgerMenu"
    class="hidden nav:hidden bg-white border-t border-gray-200 shadow-medium animate-slide-in"
    role="menu"
    aria-labelledby="nav-toggle"
  >
    <a
      href="/"
      class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center"
      class:list={[pathname == "/" && "text-green-400 font-bold"]}>Inicio</a
    >
    <a
      href="/servicios"
      class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center"
      class:list={[pathname == "/servicios" && "text-green-400 font-bold"]}
      >Servicios</a
    >
    <div>
      <div
        id="laboratoriosMobileLink"
        class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center justify-between cursor-pointer"
      >
        Laboratorios
      </div>
      <div id="laboratoriosMobile" class="hidden bg-white py-2 ml-4 border-l-2 border-primary-200">
        <a
          href="/laboratorios/laboratorio-acreditado"
          class="block px-6 py-3 text-black hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 min-h-[44px] flex items-center"
          >Laboratorio Acreditado</a
        >
        <a
          href="/laboratorios/laboratorio-con-trazabilidad-sector-biomedico-e-industrial"
          class="block px-6 py-3 text-black hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 min-h-[44px] flex items-center"
          >Laboratorio con Trazabilidad sector Biomédico e Industrial</a
        >
      </div>
    </div>
    <a
      href="/nosotros"
      class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center"
      class:list={[pathname == "/nosotros" && "text-green-400 font-bold"]}
      >Nosotros</a
    >
    <a
      href="/evaluacion-del-servicio"
      class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center"
      class:list={[
        pathname == "/evaluacion-del-servicio" && "text-green-400 font-bold",
      ]}>Evaluar servicio</a
    >
    <a
      href="/pqr"
      class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center"
      class:list={[pathname == "/pqr" && "text-green-400 font-bold"]}>PQR</a
    >
    <a
      href="/contacto"
      class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center"
      class:list={[pathname == "/contact" && "text-green-400 font-bold"]}
      >Contacto</a
    >
    <div>
      <div
        id="clientesMobileLink"
        class="block px-4 py-3 text-black font-semibold rounded hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 border-b border-gray-100 min-h-[44px] flex items-center justify-between cursor-pointer"
      >
        Clientes
      </div>
      <div id="clientesMobile" class="hidden bg-white py-2 ml-4 border-l-2 border-primary-200">
        <a
          href="https://app.metromedics.co/login"
          class="block px-6 py-3 text-black hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 min-h-[44px] flex items-center"
          >Calibraciones</a
        >
        <a
          href="/mantenimiento"
          class="block px-6 py-3 text-black hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 min-h-[44px] flex items-center"
          >Tickets</a
        >
        <a
          href="https://fm34.easytechpro.com/fmi/webd"
          class="block px-6 py-3 text-black hover:bg-primary-50 focus:outline-none focus:bg-primary-50 transition-colors duration-200 min-h-[44px] flex items-center"
          >Mantenimiento</a
        >
      </div>
    </div>
  </div>
  
  <!-- <hr class="border-b border-gray-100 opacity-25 my-0 py-0" /> -->
</nav>

<script>
  const laboratoriosLink = document.getElementById("laboratoriosLink");
  const laboratorios = document.getElementById("laboratorios");
  const laboratoriosMobileLink = document.getElementById(
    "laboratoriosMobileLink"
  );
  const laboratoriosMobile = document.getElementById("laboratoriosMobile");
  const angelUp = document.getElementById("angle-up");
  const angelDown = document.getElementById("angle-down");

  laboratoriosLink?.addEventListener("click", (e) => {
    e.preventDefault();
    const isHidden = laboratorios?.classList.contains("hidden");
    laboratorios?.classList.toggle("hidden");
    angelUp?.classList.toggle("hidden");
    angelDown?.classList.toggle("hidden");

    // Update ARIA attributes
    laboratoriosLink?.setAttribute("aria-expanded", isHidden ? "true" : "false");
  });

  laboratoriosMobileLink?.addEventListener("click", () => {
    laboratoriosMobile?.classList.toggle("hidden");
  });

  // Function to toggle burger menu visibility
  const navToggle = document.getElementById("nav-toggle");
  const burgerMenu = document.getElementById("burgerMenu");

  navToggle?.addEventListener("click", () => {
    const isHidden = burgerMenu?.classList.contains("hidden");
    burgerMenu?.classList.toggle("hidden");

    // Update ARIA attributes
    navToggle?.setAttribute("aria-expanded", isHidden ? "true" : "false");
  });

  // Function to handle scroll and change header styles
  const header = document.getElementById("header");
  const navAction = document.getElementById("navAction");
  const navContent = document.getElementById("nav-content");
  let scrollPos = window.scrollY;

  function updateHeaderStyles() {
  scrollPos = window.scrollY;
  const burgerMenu = document.getElementById("burgerMenu");
  
  if (scrollPos > 10) {
    header?.classList.add("bg-white", "shadow");
    burgerMenu?.classList.add("bg-white", "shadow"); // Mantener fondo en scroll
    navAction?.classList.remove("bg-white", "text-gray-800");
      navAction?.classList.add("gradient", "text-black");

      // ... update toggleColour elements ...

      navContent?.classList.remove("bg-gray-100");
      navContent?.classList.add("bg-white");
  } else {
    header?.classList.remove("bg-white", "shadow");
    burgerMenu?.classList.remove("shadow"); // Conservar fondo blanco siempre
    navAction?.classList.remove("gradient", "text-black");
      navAction?.classList.add("bg-white", "text-gray-800");

      // ... update toggleColour elements ...

      navContent?.classList.remove("bg-white");
      navContent?.classList.add("bg-gray-100");
  }
}

  // Add scroll event listener
  document.addEventListener("scroll", updateHeaderStyles);

  //clientes
  const clientesLink = document.getElementById("clientesLink");
  const clientes = document.getElementById("clientes");
  const clientesMobileLink = document.getElementById("clientesMobileLink");
  const clientesMobile = document.getElementById("clientesMobile");
  const angelUpClientes = document.getElementById("angle-up-clientes");
  const angelDownClientes = document.getElementById("angle-down-clientes");

  clientesLink?.addEventListener("click", (e) => {
    e.preventDefault();
    const isHidden = clientes?.classList.contains("hidden");
    clientes?.classList.toggle("hidden");
    angelUpClientes?.classList.toggle("hidden");
    angelDownClientes?.classList.toggle("hidden");

    // Update ARIA attributes
    clientesLink?.setAttribute("aria-expanded", isHidden ? "true" : "false");
  });

  clientesMobileLink?.addEventListener("click", () => {
    clientesMobile?.classList.toggle("hidden");
  });
</script>

<style>
  #burgerMenu {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    max-height: calc(100vh - 4.5rem);
    overflow-y: auto;
  }

  /* Focus styles for better accessibility */
  .focus-visible:focus {
    outline: 2px solid #22c55e;
    outline-offset: 2px;
  }

  /* Smooth transitions for dropdowns */
  #laboratorios, #clientes {
    transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
  }

  #laboratorios.hidden, #clientes.hidden {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
  }

  #laboratorios:not(.hidden), #clientes:not(.hidden) {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
</style>
